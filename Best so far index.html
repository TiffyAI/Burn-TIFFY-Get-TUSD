<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>TiffyAI Empire â€” Neon Burn & Redeem</title>
  <style>
    :root{
      --electric-blue:#00d9ff;
      --shocking-pink:#ff007f;
      --bg:#07060a;
      --glass:rgba(255,255,255,0.06);
    }
    body{
      margin:0;
      background:radial-gradient(circle at top left,#05020b 0%,#0c0021 60%);
      font-family:"Inter","Segoe UI",sans-serif;
      color:#eef;
      display:flex;
      flex-direction:column;
      align-items:center;
      min-height:100vh;
      padding:16px;
      overflow-x:hidden;
    }
    h1{
      color:var(--shocking-pink);
      text-shadow:0 0 18px var(--shocking-pink),0 0 36px var(--electric-blue);
      margin-bottom:8px;
      font-size:1.8em;
      text-align:center;
    }
    .panel{
      background:var(--glass);
      border-radius:16px;
      padding:16px;
      width:100%;
      max-width:420px;
      backdrop-filter:blur(8px);
      border:1px solid rgba(255,255,255,0.12);
      box-shadow:0 0 20px rgba(0,217,255,0.12);
      margin-bottom:18px;
    }
    .btn{
      background:linear-gradient(90deg,var(--electric-blue),var(--shocking-pink));
      border:none;
      border-radius:10px;
      color:#000;
      font-weight:700;
      padding:14px;
      font-size:1rem;
      width:100%;
      margin-top:10px;
      cursor:pointer;
    }
    .btn:disabled{opacity:.45;cursor:not-allowed;}
    label{display:block;margin-top:14px;margin-bottom:6px;font-size:.9rem;}
    input{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:none;
      background:rgba(0,0,0,0.4);
      color:#fff;
      font-size:16px;
      outline:none;
    }
    .small{font-size:.85rem;color:#bcd;}
    .row{display:flex;justify-content:space-between;align-items:center;margin-top:8px;}
    .balance{color:var(--electric-blue);}
    .tusd{color:var(--shocking-pink);}
    .gas{font-size:.8rem;background:rgba(255,255,255,0.05);padding:8px;border-radius:8px;margin-top:8px;}
    .history{max-height:220px;overflow:auto;background:rgba(0,0,0,0.25);border-radius:8px;padding:8px;margin-top:8px;}
    .tx{padding:6px;border-bottom:1px dashed rgba(255,255,255,0.1);font-size:.8rem;}
    @media(max-width:480px){
      h1{font-size:1.6em;}
      .panel{padding:14px;}
      input{font-size:15px;}
    }
  </style>
</head>
<body>
  <h1>TiffyAI Empire âš¡</h1>
  <div class="panel">
    <div class="small" style="text-align:center">
      Burn TIFFY â†’ Receive TUSD (1:20)<br>
      Verified: <a id="explorerLink" href="#" style="color:var(--electric-blue)">BscScan</a>
    </div>
    <button id="connectBtn" class="btn">ðŸ”— Connect Wallet</button>

    <label>Amount to burn (TIFFY)</label>
    <input id="burnAmount" type="number" step="0.000001" placeholder="Enter TIFFY amount"/>
    <div class="row">
      <div class="small">Youâ€™ll receive:</div>
      <div id="tusdPreview" class="tusd">0 TUSD</div>
    </div>

    <button id="estimateBtn" class="btn" disabled>âš¡ Estimate Gas</button>
    <button id="redeemBtn" class="btn" disabled>ðŸ”¥ Burn & Redeem</button>
    <button id="skimBtn" class="btn" disabled style="background:linear-gradient(90deg,#222,var(--shocking-pink));">ðŸ’¼ Owner Cash Out</button>

    <div class="row"><div class="small">TIFFY:</div><div id="tiffyBal" class="balance">â€”</div></div>
    <div class="row"><div class="small">TUSD:</div><div id="tusdBal" class="tusd">â€”</div></div>

    <div id="gasInfo" class="gas">Gas info...</div>
    <div id="status" class="small" style="margin-top:8px;">Status: idle</div>
  </div>

  <div class="panel">
    <div class="row">
      <div class="small">Local Transactions</div>
      <button id="clearHistory" class="btn" style="padding:6px 10px;font-size:.8rem;background:rgba(255,255,255,0.1);width:auto;">Clear</button>
    </div>
    <div class="history" id="historyList"></div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
<script>
/* --- addresses & ABIs same as before --- */
const SWAP_CONTRACT_ADDRESS="0xEc7B2ebe558424d0d3929c581e0018d2bEDe8eF6";
const TIFFY_ADDRESS="0xE488253DD6B4D31431142F1b7601C96f24Fb7dd5";
const OWNER_ADDRESS="0x2a234d5cc7431b824723c84c8605fd3968bf0255".toLowerCase();
const RATE=20;

const ERC20_ABI=[{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"type":"function"}];
const SWAP_ABI=[{"inputs":[{"name":"amount","type":"uint256"}],"name":"redeemTiffy","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"swapSkimToUSDT","outputs":[],"stateMutability":"nonpayable","type":"function"}];

let web3,userAddr,tiffyContract,swapContract;

const connectBtn=document.getElementById("connectBtn");
const estimateBtn=document.getElementById("estimateBtn");
const redeemBtn=document.getElementById("redeemBtn");
const skimBtn=document.getElementById("skimBtn");
const burnInput=document.getElementById("burnAmount");
const tusdPreview=document.getElementById("tusdPreview");
const tiffyBalEl=document.getElementById("tiffyBal");
const tusdBalEl=document.getElementById("tusdBal");
const statusEl=document.getElementById("status");
const gasInfo=document.getElementById("gasInfo");
const historyList=document.getElementById("historyList");
const clearHistory=document.getElementById("clearHistory");
const explorerLink=document.getElementById("explorerLink");
explorerLink.href=`https://bscscan.com/address/${SWAP_CONTRACT_ADDRESS}`;

function setStatus(msg){statusEl.innerText='Status: '+msg;}
function storeTx(tx){const list=JSON.parse(localStorage.getItem('tiffy_history')||'[]');list.unshift(tx);localStorage.setItem('tiffy_history',JSON.stringify(list));renderHistory();}
function renderHistory(){const list=JSON.parse(localStorage.getItem('tiffy_history')||'[]');historyList.innerHTML=list.map(x=>`<div class="tx">${x.type}: ${x.amount} TIFFY â†’ ${x.tusd} TUSD<br><span class="small">${new Date(x.ts).toLocaleString()} (${x.status})</span></div>`).join('')||'<div class="small">None yet</div>';}

async function connectWallet(auto=false){
 if(!window.ethereum){setStatus("MetaMask not found");return;}
 web3=new Web3(window.ethereum);
 try{
   const accs=auto?await window.ethereum.request({method:"eth_accounts"}):await window.ethereum.request({method:"eth_requestAccounts"});
   if(!accs.length){if(!auto)setStatus("Please connect wallet");return;}
   userAddr=accs[0];
   tiffyContract=new web3.eth.Contract(ERC20_ABI,TIFFY_ADDRESS);
   swapContract=new web3.eth.Contract(SWAP_ABI,SWAP_CONTRACT_ADDRESS);
   connectBtn.textContent="âœ… Connected";
   estimateBtn.disabled=false;redeemBtn.disabled=false;
   skimBtn.disabled=(userAddr.toLowerCase()!==OWNER_ADDRESS);
   setStatus("Connected: "+userAddr.slice(0,8)+"...");
   refreshBalances();
 }catch(e){setStatus("Connect failed: "+e.message);}
}

async function refreshBalances(){
 try{
   const bal=await tiffyContract.methods.balanceOf(userAddr).call();
   const human=(+web3.utils.fromWei(bal)).toFixed(4);
   tiffyBalEl.innerText=human+" TIFFY";
 }catch(e){tiffyBalEl.innerText="N/A";}
 tusdBalEl.innerText="â€”";
}

async function redeemFlow(){
 const amt=parseFloat(burnInput.value);if(!amt||amt<=0){setStatus("Enter amount");return;}
 try{
   const units=web3.utils.toWei(amt.toString());
   setStatus("Approving TIFFY...");
   await tiffyContract.methods.approve(SWAP_CONTRACT_ADDRESS,units).send({from:userAddr});
   setStatus("Burning "+amt+" TIFFY...");
   const tx=await swapContract.methods.redeemTiffy(units).send({from:userAddr});
   storeTx({type:"Burn",amount:amt,tusd:amt*RATE,ts:Date.now(),status:"confirmed"});
   setStatus("Burn confirmed!");
   refreshBalances();
 }catch(e){setStatus("Error: "+e.message);}
}

burnInput.addEventListener("input",()=>{const v=parseFloat(burnInput.value)||0;tusdPreview.textContent=(v*RATE).toFixed(4)+" TUSD";});
connectBtn.addEventListener("click",()=>connectWallet(false));
redeemBtn.addEventListener("click",redeemFlow);
clearHistory.addEventListener("click",()=>{localStorage.removeItem("tiffy_history");renderHistory();});
renderHistory();
window.addEventListener("load",()=>connectWallet(true)); // auto-connect attempt
</script>
</body>
</html>
