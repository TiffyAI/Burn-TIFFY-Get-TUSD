<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>TiffyAI Empire â€” Burn & Redeem</title>
  <style>
    :root{
      --electric-blue:#00d9ff;
      --shocking-pink:#ff007f;
      --bg:#07060a;
      --glass:rgba(255,255,255,0.06);
    }
    body{
      margin:0;
      background:radial-gradient(circle at top left,#05020b 0%,#0c0021 60%);
      font-family:"Inter","Segoe UI",sans-serif;
      color:#eef;
      display:flex;
      flex-direction:column;
      align-items:center;
      min-height:100vh;
      padding:16px;
    }
    h1{color:var(--shocking-pink);text-shadow:0 0 18px var(--shocking-pink),0 0 36px var(--electric-blue);margin-bottom:8px;text-align:center;}
    .panel{background:var(--glass);border-radius:16px;padding:16px;width:100%;max-width:420px;backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,0.12);box-shadow:0 0 20px rgba(0,217,255,0.12);margin-bottom:18px;}
    .btn{background:linear-gradient(90deg,var(--electric-blue),var(--shocking-pink));border:none;border-radius:10px;color:#000;font-weight:700;padding:14px;font-size:1rem;width:100%;margin-top:10px;cursor:pointer;}
    .btn:disabled{opacity:.45;cursor:not-allowed;}
    label{display:block;margin-top:14px;margin-bottom:6px;font-size:.9rem;}
    input{width:100%;padding:12px;border-radius:10px;border:none;background:rgba(0,0,0,0.4);color:#fff;font-size:16px;outline:none;}
    .small{font-size:.85rem;color:#bcd;}
    .row{display:flex;justify-content:space-between;align-items:center;margin-top:8px;}
    .balance{color:var(--electric-blue);}
    .tusd{color:var(--shocking-pink);}
  </style>
</head>
<body>
  <h1>TiffyAI Empire âš¡</h1>

  <div class="panel">
    <div class="small" style="text-align:center">
      Burn TIFFY â†’ Receive TUSD (based on live price)<br>
      <span id="priceInfo" style="color:var(--electric-blue)">Loading price...</span><br>
      Verified: <a id="explorerLink" href="#" style="color:var(--electric-blue)">BscScan</a>
    </div>

    <button id="connectBtn" class="btn">ðŸ”— Connect Wallet</button>

    <label>Amount to burn (TIFFY)</label>
    <input id="burnAmount" type="number" step="0.000001" placeholder="Enter TIFFY amount"/>
    <div class="row">
      <div class="small">Youâ€™ll receive:</div>
      <div id="tusdPreview" class="tusd">0 TUSD</div>
    </div>

    <button id="estimateBtn" class="btn" disabled>âš¡ Estimate Gas</button>
    <button id="redeemBtn" class="btn" disabled>ðŸ”¥ Burn & Redeem</button>

    <div id="status" class="small" style="margin-top:8px;">Status: idle</div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
<script>
const SWAP_CONTRACT_ADDRESS="0xEc7B2ebe558424d0d3929c581e0018d2bEDe8eF6";
const TIFFY_ADDRESS="0xE488253DD6B4D31431142F1b7601C96f24Fb7dd5";
const OWNER_ADDRESS="0x2a234d5cc7431b824723c84c8605fd3968bf0255".toLowerCase();
const PRICE_URL="https://tiffyai.github.io/TIFFY-Market-Value/price.json";

const ERC20_ABI=[{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"type":"function"}];
const SWAP_ABI=[{"inputs":[{"name":"amount","type":"uint256"}],"name":"redeemTiffy","outputs":[],"stateMutability":"nonpayable","type":"function"}];

let web3,userAddr,tiffyContract,swapContract,tiffyToUSD=0;

const connectBtn=document.getElementById("connectBtn");
const estimateBtn=document.getElementById("estimateBtn");
const redeemBtn=document.getElementById("redeemBtn");
const burnInput=document.getElementById("burnAmount");
const tusdPreview=document.getElementById("tusdPreview");
const statusEl=document.getElementById("status");
const priceInfo=document.getElementById("priceInfo");
const explorerLink=document.getElementById("explorerLink");
explorerLink.href=`https://bscscan.com/address/${SWAP_CONTRACT_ADDRESS}`;

function setStatus(msg){statusEl.innerText='Status: '+msg;}

async function fetchPrice(){
  try{
    const res=await fetch(PRICE_URL);
    const data=await res.json();
    tiffyToUSD=parseFloat(data.tiffyToUSD);
    priceInfo.textContent=`1 TIFFY = $${tiffyToUSD.toLocaleString(undefined,{maximumFractionDigits:2})}`;
  }catch(e){
    priceInfo.textContent="âš ï¸ Could not load price";
    console.error(e);
  }
}

async function connectWallet(){
  if(!window.ethereum){setStatus("MetaMask not found");return;}
  web3=new Web3(window.ethereum);
  const accs=await window.ethereum.request({method:"eth_requestAccounts"});
  userAddr=accs[0];
  tiffyContract=new web3.eth.Contract(ERC20_ABI,TIFFY_ADDRESS);
  swapContract=new web3.eth.Contract(SWAP_ABI,SWAP_CONTRACT_ADDRESS);
  connectBtn.textContent="âœ… Connected";
  estimateBtn.disabled=false;
  redeemBtn.disabled=false;
  setStatus("Connected: "+userAddr.slice(0,8)+"...");
}

burnInput.addEventListener("input",()=>{
  const amt=parseFloat(burnInput.value)||0;
  const tusd=amt*tiffyToUSD;
  tusdPreview.textContent=isNaN(tusd)?'0 TUSD':tusd.toFixed(2)+' TUSD';
});

estimateBtn.addEventListener("click",()=>{
  const amt=parseFloat(burnInput.value);
  if(!amt||amt<=0){setStatus("Enter amount first");return;}
  setStatus(`Gas estimate ready for ${amt} TIFFY`);
});

async function redeemFlow(){
  const amt=parseFloat(burnInput.value);
  if(!amt||amt<=0){setStatus("Enter amount");return;}
  try{
    const units=web3.utils.toWei(amt.toString());
    await tiffyContract.methods.approve(SWAP_CONTRACT_ADDRESS,units).send({from:userAddr});
    setStatus("Burning "+amt+" TIFFY...");
    await swapContract.methods.redeemTiffy(units).send({from:userAddr});
    setStatus(`âœ… Burned ${amt} TIFFY â€” issued ${(amt*tiffyToUSD).toFixed(2)} TUSD`);
  }catch(e){setStatus("Error: "+e.message);}
}

connectBtn.addEventListener("click",connectWallet);
redeemBtn.addEventListener("click",redeemFlow);

fetchPrice();
</script>
</body>
</html>
